#include <libraries.h>

// That file include all varibles used for encoder program

// Pins
const int progibomerCLOCK_PIN  {25}; // RX pin
const int progibomerDATA_PIN  {26}; //TX pin
const int BIT_COUNT  {17}; //amount of bits encoder have 
const int SD_PIN {14};  // pin for sd card
#define BUTTON_PIN 33 // pin for mode button
#define resetBUTTON_PIN 32 // pin for reset button (result to zero)
const int LED_PIN {15}; // pin for LED
const int encoders1data {34};
const int encoders2clock {35};
const int encoderbutton{27};
// Math
const float formula2  {0.000999964};
//0.0000153547881599881 - 24 bit
const long formula1  {8000000};
unsigned long step2 {};
float step3 {};
float result {};
float zerovalue{}; // the value to subtract to get 0 for result
float minvalue {0};
float maxvalue {0};

//limits
int limMode {0}; //  1 = set high limit    2 = set low limit  0 = regular mode
float highlim {0};
float lowlim {};

//Time
int timing {12};
int Btime {0};
int timer_count[4] = {0, 0, 0, 0};
unsigned long last_time {};
long programDelay {};
int convertYear {};
String convertMinute {};
String convertSecond{};
int lastHour{};
int lastMinute{};

//Button
boolean DynamicMode;
unsigned long lastDebounceTime {0};
unsigned long lastResetDebounceTime {0};
int buttonState;
int resetButtonState;
long DEBOUNCE_TIME {50};
int lastButtonState = LOW;  // the previous reading from the input pin
int lastResetButtonState = LOW;
boolean staticTitle = true;

//Initialization
String dataMessage;
String title;
String messageDIN;
String timeDIN;

//File Name
String fileNameDAT;
String fileNameDIN;
String fileNameTimeDAT;
String fileNameTimeDIN;

//Functions
void appendFile(fs::FS &fs, const char * path, const char * message);
void createDir(fs::FS &fs, const char * path);
unsigned long readPosition();
unsigned long shiftIn(const int data_pin, const int clock_pin, const int bit_count);
void createDirectories(const char* path);
void isr(); // encoder Interrupt

// SciBIM logo pic for display
// 'Science Gauge', 90x40px
const unsigned char epd_bitmap_Science_Gauge [] PROGMEM = {
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1c, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x13, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0xc0, 0x10, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x10, 0x7f, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x10, 0xff, 0x01, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x06, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x02, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0xff, 0x03, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x02, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0xff, 0x03, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x02, 0x10, 0xff, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x02, 0x10, 0xff, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x60, 0x02, 0x10, 0xff, 0x73, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x78, 0x02, 0x10, 0xff, 0xf3, 0x01, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x7e, 0x02, 0x10, 0xff, 0xf3, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x7f, 
	0x02, 0x10, 0xff, 0xf3, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 
	0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 
	0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 
	0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 
	0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 
	0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 
	0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 
	0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x7f, 0x02, 0x10, 0xff, 0xf3, 0xff, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0xf0, 0x7f, 0xfc, 0x1f, 0x00, 0xf0, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};
// Array of all bitmaps for convenience. (Total bytes used to store images in PROGMEM = 496)
const int epd_bitmap_allArray_LEN = 1;
const unsigned char* epd_bitmap_allArray[1] = {
	epd_bitmap_Science_Gauge
};
